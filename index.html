<!DOCTYPE html>
<html>
    <head>
        <title>Gear.js</title>
        <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Economica" />
        <link rel="stylesheet" type="text/css" href="docs/index.css" />
        <link rel="stylesheet" type="text/css" href="docs/monokai.css" />
    </head>
    <body>
        <a href="https://github.com/yahoo/gear"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>

        <header>
            <h1>Gear.js</h1>
        </header>

        <article>
            <section name="intro">
                <h2>Task-Based Build System</h2>
                <p>Gear.js is a scriptable build system using simple tasks that act like a sequence of piped commands.</p>
                
                <h3>Features include:</h3>
                <ul>
                    <li>Runs in Node and the browser.</li>
                    <li>Basic building blocks that can be combined to perform complex builds.</li>
                    <li>Tasks are simply defined and keep system internals to a minimum.</li>
                    <li>Asynchronous execution.</li>
                    <li>Extensible task loading via NPM, file, or directory.</li>
                    <li>Advanced flow control for complex task execution.</li>
                </ul>
            </section>

            <section name="installation">
                <h2>Installation</h2>

                <h3>Node</h3>
                <p>To get the most out of Gear.js, install <a href="http://github.com/yahoo/gear-lib">gear-lib</a> which contains tasks for linting, minifying, and deploying JS/CSS assets.</p>
<pre><code class="bash">$ npm install gear
$ npm install gear-lib
</code></pre>

                <h3>Browser</h3>

                <ul>
                    <li><a href="https://github.com/yahoo/gear/raw/master/build/gear.js">Development</a></li>
                    <li><a href="https://github.com/yahoo/gear/raw/master/build/gear.min.js">Production</a></li>
                </ul>

<pre><code class="html">&lt;script type=&quot;text/javascript&quot; src=&quot;https://github.com/yahoo/gear-lib/raw/master/build/gear-lib.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://github.com/yahoo/gear/raw/master/build/gear.js&quot;&gt;&lt;/script&gt;
</code></pre>
            </section>

            <section name="examples">
                <h2>Quick Examples</h2>

                <h3>Chaining Tasks</h3>

                <div class="example">
                    <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                    <div class="code">
<pre><code class="javascript">new Queue()
    .read('foo.js')
    .log('read foo.js')
    .inspect()
    .write('foo2.js')
    .run();</code></pre>
                    </div>
                    
                    <div class="result"><pre></pre></div>
                </div>

                <h3>Execute Tasks Using Array Style</h3>

                <div class="example">
                    <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                    <div class="code">
<pre><code class="javascript">new Queue()
    .read(['foo.js', {name: 'bar.js'}, 'baz.js'])
    .log('read files')
    .inspect()
    .write(['foo2.js', 'bar2.js']) // Not writing 'baz.js'
    .run();</code></pre>
                    </div>
                    
                    <div class="result"><pre></pre></div>
                </div>

                <h3>Parallel Task Execution</h3>

                <div class="example">
                    <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                    <div class="code">
<pre><code class="javascript">new Queue()
    .read('foo.js')
    .log('Parallel Tasks')
    .tasks({
        read:     {task: ['read', ['bar.js', 'baz.js']]},
        combine:  {requires: 'read', task: 'concat'},
        minify:   {requires: 'combine', task: 'jsminify'},
        print:    {requires: 'minify', task: 'inspect'},
        parallel: {task: ['log', "Hello Gear.js world!"]}, // Run parallel to read
        join:     {requires: ['parallel', 'print']} // Joined data is passed to next task in queue
     })
     .inspect()
     .run();</code></pre>
                    </div>
                    
                    <div class="result"><pre></pre></div>
                </div>
            </section>

            <section id="docs">
                <h2>Documentation</h2>

                <h3>Queue</h3>
                <ul>
                    <li><a href="#Queue">Queue</a></li>
                    <li><a href="#Queue.task">Queue.task</a></li>
                    <li><a href="#Queue.run">Queue.run</a></li>
                </ul>

                <h3>Registry</h3>
                <ul>
                    <li><a href="#Registry">Registry</a></li>
                    <li><a href="#Registry.load">Registry.load</a></li>
                </ul>

                <h3>Tasks</h3>
                <ul>
                    <li><a href="#tasks.read">read</a></li>
                    <li><a href="#tasks.write">write</a></li>
                    <li><a href="#tasks.concat">concat</a></li>
                    <li><a href="#tasks.inspect">inspect</a></li>
                    <li><a href="#tasks.log">log</a></li>
                    <li><a href="#tasks.tasks">tasks</a></li>
                </ul>

                <h3><a href="#library">Library Tasks</a></h3>

                <h3><a href="#custom">Custom Tasks</a></h3>

                <div name="Queue">
                    <h3>Queue()</h3>
                    <h3>Queue(options)</h3>

                    <p>Queue constructor.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>options - (Object) Options for queue.</li>
                        <li>options.logger - (Object) Logger instance, usually console.</li>
                        <li>options.registry - (Registry) Registry loaded with available tasks.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Queue()
    .log('New queue')
    .run();</code></pre>
                    </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="Queue.task">
                    <h3>Queue.task(name)</h3>
                    <h3>Queue.task(name, options)</h3>

                    <p>Helper method to run the specified task. Preferred task execution style is to call the task directly i.e. <strong>inspect()</strong> instead of <strong>task('inspect')</strong>.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>name - (String) Name of task in registry.</li>
                        <li>options - Task specific options.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Queue()
    .task('log', 'New queue')
    .run();</code></pre>
                    </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="Queue.run">
                    <h3>Queue.run()</h3>
                    <h3>Queue.run(callback)</h3>

                    <p>Runs the queue.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>callback - (Function(err, results)) Called on queue completion.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Queue()
    .log('test')
    .run();</code></pre>
                    </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="Registry">
                    <h3>Registry()</h3>
                    <h3>Registry(options)</h3>

                    <p>Creates a new Registry instance. Registries contain available tasks.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>options - See Registry.load.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Registry();</code></pre>
                    </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="Registry.load">
                    <h3>Registry.load(options)</h3>

                    <p>Load tasks from NPM module, directory, or file.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>options.module - Module to load tasks from.</li>
                        <li>options.dirname - Directory to load tasks from.</li>
                        <li>options.filename - File to load tasks from.</li>
                        <li>options.tasks - Object to load tasks from.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Registry().load({dirname: 'foo'});</code></pre>
                    </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="tasks.read">
                    <h3>read(name)</h3>
                    <h3>read(options)</h3>

                    <p>Appends file contents onto queue.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>name - (String) Filename to read.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Queue()
    .read('foo.js')
    .read(['foo.js', 'bar.js'])
    .read([{name: 'foo.js'}, {name: 'bar.js'}, {name: 'baz.js'}])
    .run(function(err, results) {
        console.log(('' + results[0]).length + ' characters');
    });</code></pre>
                        </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="tasks.read">
                    <h3>write(name)</h3>
                    <h3>write(options)</h3>

                    <p>Write the blob to disk.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>name - (String) File to write, will replace {checksum} with hash of blob content.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Queue()
    .read('foo.js')
    .write('foo2.js')
    .write({name: 'foo3.js'})
    .inspect()
    .run();</code></pre>
                        </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="tasks.concat">
                    <h3>concat()</h3>
                    <h3>concat(callback)</h3>

                    <p>Concatenates blobs.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>callback - (Function) N/A.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Queue()
    .read(['foo.js', 'bar.js'])
    .concat()
    .inspect()
    .run();</code></pre>
                        </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="tasks.inspect">
                    <h3>inspect()</h3>

                    <p>Inspects blobs.</p>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Queue()
    .read(['foo.js', 'bar.js'])
    .inspect()
    .run();</code></pre>
                        </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="tasks.log">
                    <h3>log(message)</h3>

                    <p>Log a message.</p>

                    <h4>Arguments</h4>
                    <ul>
                        <li>message - (String) Message to log.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">new Queue()
    .log('Hi')
    .run();</code></pre>
                        </div>
                        
                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="tasks.tasks">
                    <h3>tasks(workflow)</h3>

                    <h4>Arguments</h4>
                    <ul>
                        <li>workflow - (Object) Task workflow described below.</li>
                    </ul>

                    <div class="example">
                        <button type="button"><span class="run">Run</span><span class="clear">Clear</span></button>

                        <div class="code">
<pre><code class="javascript">// label - Task instance name.
// label.task - Task name and optionally options.
// label.requires - List of labels that must be executed before this task runs.
new Queue()
    .read('foo.js')
    .tasks({
        dev:     {task: ['write', 'output.js']},
        prodmin: {task: 'jsminify'},
        prod:    {requires: 'prodmin', task: ['write', 'output.min.js']},
        join:    {requires: ['dev', 'prod']}
    })
    .run(function() {
        console.log('output.js - ' + localStorage['output.js'].length);
        console.log('output.min.js - ' + localStorage['output.min.js'].length);
    });</code></pre>
                        </div>

                        <div class="result"><pre></pre></div>
                    </div>
                </div>

                <div name="library">
                    <h3>Library Tasks</h3>

                    <p>Install <a href="http://github.com/yahoo/gear-lib">gear-lib</a> which contains tasks such as:</p>

                    <ul>
                        <li>jslint</li>
                        <li>jsminify</li>
                        <li>csslint</li>
                        <li>cssminify</li>
                        <li>s3</li>
                    </ul>

                    <pre><code class="bash">$ npm install gear-lib</code></pre>
                </div>

                <div name="custom">
                    <h3>Custom Tasks</h3>

                    <p>Writing a task is especially easy compared to other Node build systems. Tasks operate on simple immutable blobs. The task returns a transformed blob via its callback.</p>


                    <h4>Arguments</h4>
                    <ul>
                        <li>options - Options for the task.</li>
                        <li>blob - Immutable blob.</li>
                        <li>done(err, result) - Callback executed when task is complete.</li>
                    </ul>

<pre><code class="javascript">// example.js
// Example task creates new blob containing `string`
exports.example = function(string, blob, done) {
    done(null, new blob.constructor(string)); // blob.constructor() is equivalent to Blob()
};
</code></pre>

                    <h4>Running Example Task</h4>

<pre><code class="javascript">new Queue({registry: new Registry({filename: 'example.js'})})
 .example('EXAMPLE')
 .run();
</code></pre>
                </div>
            </section>

            <section>
                <h2>Who's Using Gear.js</h2>
                <p><a href="http://github.com/yahoo/mojito-shaker">Mojito Shaker</a> by <a href="http://github.com/yahoo">Yahoo</a>.</p>
            </section>

            <section>
                <h2>Special Thanks</h2>
                <p>Gear.js takes inspiration from a few sources:</p>
                <ul>
                    <li><a href="http://github.com/mosen/buildy">buildy</a> created by <a href="http://github.com/mosen">mosen</a>.</li>
                    <li><a href="http://github.com/cowboy/grunt">grunt</a> created by <a href="http://github.com/cowboy">cowboy</a>.</li>
                </ul>
            </section>
        </section>



        <script type="text/javascript" src="docs/highlight.min.js"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>

        <script type="text/javascript" src="http://yui.yahooapis.com/combo?3.5.1/build/yui/yui-min.js"></script>
        <script type="text/javascript" src="build/gear-full.js"></script>

        <script type="text/javascript">
        YUI().use('event', function(Y) {
            ['foo', 'bar', 'baz'].forEach(function(name) {
                localStorage[name + '.js'] = 'var ' + name +  ' = function ' + name + '() { console.log("' + name + '"); };';
            });

            /*
            Y.one('#files').on('change', function(e) {
                var raw_files = e.currentTarget.getDOMNode().files;

                Array.prototype.forEach.call(raw_files, function(file) {
                    var reader = new FileReader();

                    reader.onload = function(e) {
                        localStorage[file.name] = e.target.result;
                        files.push(file.name);
                    };

                    reader.onerror = function(e) {
                        alert("Can't read local files");
                    };

                    reader.readAsBinaryString(file);
                });
            });*/

            Y.all('.example button').on('click', function(e) {
                var example = e.currentTarget.get('parentNode');

                if (!example.hasClass('show')) {
                    var code = example.one('.code pre').get('text'),
                        result = example.one('.result pre'),
                        _console = window.console,
                        console = {
                            log: function(msg) {
                                if (_console) {_console.log(msg);}
                                if (result) {
                                    result.set('text', result.get('text') + '> ' + JSON.stringify(msg) + '\n');
                                }
                            },
                            error: function(msg) {
                                if (_console) {_console.error(msg);}
                                if (result) {
                                    result.set('text', result.get('text') + '> ' + JSON.stringify(msg) + '\n');
                                }
                            }
                        },
                        Queue = gear.Queue.bind(this, {logger: console}),
                        Registry = gear.Registry;

                    result.set('text', '');

                    var ret = eval(code);
                    if (ret !== undefined) {console.log(ret);}
                }

                example.toggleClass('show');
            });
        });
        </script>
    </body>
</html>